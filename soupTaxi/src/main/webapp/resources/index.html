<!DOCTYPE html>
<html>

	<body>
		<div id="map_canvas" style="width:500px;height:500px;"></div>

		<form id = "userinfo" >
			<input type = "text" id = "userlat" name = "userlat" />
			<input type = "text" id = "userlng" name = "userlng" />
			출발: <input type = "text" id = "start" name = "start" />
			des: <input type = "text" id = "end" name = "end" />
			<button id = "reserv">reserv</button>
		</form>
		<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>
		<script>
			document.getElementById("reserv").addEventListener("click", function() {
				event.preventDefault();
				return false;
			});
			
			function showinfo(position) {
				console.log('showinfo');
				document.getElementById("userlat").value = position.coords.latitude;
				document.getElementById("userlng").value = position.coords.longitude;

				var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
				//var marker_name = "test";
				var marker_position = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
				var myOptions = {
					zoom : 15,
					center : latlng,
					mapTypeId : google.maps.MapTypeId.ROADMAP,
					zoomControl : true,
					streetViewControl : false,
					disableDoubleClickZoom : false,
					draggable : true,
					scrollwheel : true,
					mapTypeControl : false,
					scaleControl : true,
					rotateControl : false,
					panControl : false
				};

				var image = 'favicon.ico';
				//map display
				var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

				var markers = [{
					position : new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
					map : map,
					title : 'user'
				}, {
					position : new google.maps.LatLng(position.coords.latitude, position.coords.longitude + 0.01),
					map : map,
					icon : image,
					title : 'taxi1'
				}, {
					position : new google.maps.LatLng(position.coords.latitude - 0.01, position.coords.longitude),
					map : map,
					icon : image,
					title : 'taxi2'
				}, {
					position : new google.maps.LatLng(position.coords.latitude, position.coords.longitude - 0.01),
					map : map,
					icon : image,
					title : 'taxi3'
				}, {
					position : new google.maps.LatLng(position.coords.latitude + 0.01, position.coords.longitude),
					map : map,
					icon : image,
					title : 'taxi4'
				}];

				for ( id = 0; id < markers.length; id++) {
					new google.maps.Marker(markers[id]);
				}

			}

			function showerror(error) {
				alert('error code: ' + error.code + ', error msg: ' + error.message);
			}
			
			(function(){
				var geoconfig = {
					enableHighAccuracy : true, //정확도 높은 위치정보를 요구. 단, 그만큼 느려진다.
					timeout : 10000, //제한 시간 내에 값을 엊지 못하면 TIMEOUT에러가 리턴.
					maximumAge : 6000 //위치정보의 유효기간을 설정. 이전 위치는 캐시에 저장된다.
					//리소스 소비를 줄이고 빠른 응답을 위해 새로운 위치를 검색하는 대신에 저장된 정보를 가져오는 방식이  더 적합한 경우에 사용.
				};
				navigator.geolocation.watchPosition(showinfo, showerror, geoconfig);
			}());
		</script>
	</body>
</html>
