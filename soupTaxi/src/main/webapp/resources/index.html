<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<title>soup taxi</title>
<meta name="description" content="">
<meta name="author" content="bit">

<meta name="viewport" content="width=device-width; initial-scale=1.0">
 
<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
<link rel="shortcut icon"
	href="/safeTaxi/src/main/webapp/resources/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<script 
	src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript"
	src="https://maps.google.com/maps/api/js?sensor=true"></script>
</head>

<body>
	
	<div id="messages"></div>
	
	
	<div id="map_canvas" style="width: 100%; height: 500px;"></div>

	<div id="condition">
		흡연차량:<input type="checkbox" name="smoke" /> 아 기:<input
			type="checkbox" name="baby" /> 짐이많음:<input type="checkbox"
			name="pack" /> 애완동물:<input type="checkbox" name="pet" /> 여성기사:<input
			type="checkbox" name="gender" /> 장 애:<input type="checkbox"
			name="weak" />
	</div>

	<form id="userinfo">
		<input type="text" id="userlat" name="userlat" /> 
		<input type="text" id="userlng" name="userlng" />
		출발지: <input type="text" id="start" name="start" />
		 목적지: <input type="text" id="end" name="end" />
		<select name="later">
			<option value="0">지 금</option>
			<option value="5">5분 후</option>
			<option value="10">10분 후</option>
			<option value="15">15분 후</option>
			<option value="20">20분 후</option>
		</select>
		<button id="transmit">예약</button>
	</form>
	<button id="getlocation">current location</button>
	<script src="http://192.168.0.24:4000/socket.io/socket.io.js"></script>
	<script>
		var messagesElement = document.getElementById('messages');
		var lastMessageElement = null;
		function addMessage(message) {
			var newMessageElement = document.createElement('div');
			var newMessageText = document.createTextNode(message);
			newMessageElement.appendChild(newMessageText);
			messagesElement.insertBefore(newMessageElement, lastMessageElement);
			lastMessageElement = newMessageElement;
		}
		
		var socket = io.connect('http://localhost:4000');
		socket.on('serverMessage', function(content) {
			addMessage(content);
		});
		socket.on('login', function() {
			var username = prompt('What username would you like to use?');
			socket.emit('login', username);
		});
		document.getElementById("condition").addEventListener("click", function(event) {
			var target = event.target.name;
	
			console.log(target);
		});
		document.getElementById("transmit").addEventListener("click", function() {
			event.preventDefault();
			var msg = $('#userinfo').serialize();
			socket.emit('clientMessage', msg);
			console.log(serialize);
			return false;
		});

		document.getElementById("getlocation").addEventListener("click", function() {
			var geoconfig = {
				enableHighAccuracy : true, //정확도 높은 위치정보를 요구. 단, 그만큼 느려진다.
				timeout : 10000, //제한 시간 내에 값을 엊지 못하면 TIMEOUT에러가 리턴.
				maximumAge : 60000
			//위치정보의 유효기간을 설정. 이전 위치는 캐시에 저장된다. 
			//리소스 소비를 줄이고 빠른 응답을 위해 새로운 위치를 검색하는 대신에 저장된 정보를 가져오는 방식이  더 적합한 경우에 사용.
			};
			control = navigator.geolocation.watchPosition(showinfo,	showerror, geoconfig);
			console.log(control);
		});

		function showinfo(position) {
			console.log("showinfo");
			console.log(position);
			var location = document.getElementById("location");

			var lat = position.coords.latitude;
			var lng = position.coords.longitude;
			document.getElementById("userlat").value = lat;
			document.getElementById("userlng").value = lng;

			var latlng = new google.maps.LatLng(position.coords.latitude,
					position.coords.longitude);
			var marker_name = "test";
			var marker_position = new google.maps.LatLng(
					position.coords.latitude, position.coords.longitude);
			var myOptions = {
				zoom : 15,
				center : latlng,
				mapTypeId : google.maps.MapTypeId.ROADMAP,
				zoomControl : true,
				streetViewControl : false,
				disableDoubleClickZoom : false,
				draggable : true,
				scrollwheel : true,
				mapTypeControl : false,
				scaleControl : true,
				rotateControl : false,
				panControl : false
			};

			var icon = 'images/taxi.png'; //택시 이미지로...
			var map = new google.maps.Map(
					document.getElementById("map_canvas"), myOptions);

			var markers = [];
			var position = function(position, map, title, icon) {
				this.position = position;
				this.map = map;
				this.icon = icon;
				this.title = title;
			};

			markers.push(new position(new google.maps.LatLng(lat, lng), map, 'user'));
			markers.push(new position(new google.maps.LatLng(lat + 0.01, lng), map, 'taxi1', icon));
			markers.push(new position(new google.maps.LatLng(lat, lng + 0.01), map, 'taxi2', icon));
			markers.push(new position(new google.maps.LatLng(lat - 0.01, lng), map, 'taxi3', icon));
			markers.push(new position(new google.maps.LatLng(lat, lng - 0.01), map, 'taxi3', icon));

			console.log("markers" + markers);

			for (id = 0; id < markers.length; id++) {
				new google.maps.Marker(markers[id]);
			}
		}
		function showerror(error) {
			alert('Error: ' + error.code + ' ' + error.message);
		}
		(function() {
			var geoconfig = {
				enableHighAccuracy : true, //정확도 높은 위치정보를 요구. 단, 그만큼 느려진다.
				timeout : 10000, //제한 시간 내에 값을 엊지 못하면 TIMEOUT에러가 리턴.
				maximumAge : 6000
			//위치정보의 유효기간을 설정. 이전 위치는 캐시에 저장된다.
			//리소스 소비를 줄이고 빠른 응답을 위해 새로운 위치를 검색하는 대신에 저장된 정보를 가져오는 방식이  더 적합한 경우에 사용.
			};
			navigator.geolocation.watchPosition(showinfo, showerror, geoconfig);
		}());
	</script>
</body>
</html>


